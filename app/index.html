<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="documentTitle">IgniteInbox: Your AI-Powered Outreach Engine</title>
    
    <!-- Google Fonts: Inter for LTR, Cairo for RTL -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Animated background particles container -->
    <div class="particle-container" id="particleContainer"></div>

    <!-- Language switcher with better spacing -->
    <div class="language-selector-container" id="languageSelectorContainer">
        <button value="en" class="active">English</button>
        <button value="ar">العربية</button>
        <button value="fr">Français</button>
    </div>

    <!-- Added a Logout button for demonstration -->
      <!-- NEW: User Profile and Logout Container -->
          <!-- Correct User Profile and Logout Container -->
    <div id="userProfileContainer" class="user-profile-container hidden">
        <div class="user-info-display" id="userInfoDisplay">
            <span id="userNameDisplay"></span>
            <button id="userDropdownToggle" class="dropdown-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>
            </button>
        </div>
        <div id="userDropdownMenu" class="dropdown-menu hidden">
            <button id="logoutButton" class="dropdown-item4">Logout</button>
        </div>
    </div>
    <!-- END Correct User Profile -->

    <div class="container">
        <!-- Header with improved flame and spacing -->
        <div class="header">
            <div class="red-flame-logo">
                <div class="red-flame-logo-glow"></div>
                <div class="red-flame-logo-main"></div>
                <div class="red-flame-logo-inner-orange-red"></div>
                <div class="red-flame-logo-core-orange"></div>
                <div class="red-flame-logo-inner-yellow-orange"></div>
                <div class="red-flame-logo-center-hotspot"></div>
            </div>
            
            <h1 data-key="headerTitle">IgniteInbox</h1>
            
            <div class="space-y-3">
                <p data-key="headerTagline">Your AI-Powered Outreach Engine</p>
                <p data-key="headerDescription">Transform your cold outreach with personalized, high-converting emails generated by advanced AI</p>
            </div>
        </div>

        <!-- Main form structure using previous class names -->
        <div class="grid-container">
            <!-- Sender details -->
            <div class="card">
                <div class="card-header">
                    <!-- Removed inline SVG here, it will be injected by script.js -->
                    <h2 data-key="yourSenderDetailsTitle">Your Sender Details</h2>
                </div>
                
                <div class="space-y-5">
                    <input type="text" id="senderName" name="senderName" data-key="yourNamePlaceholder" placeholder="Your Name" class="form-input" required>
                    <input type="email" id="senderEmail" name="senderEmail" data-key="yourEmailPlaceholder" placeholder="Your Email" class="form-input" required>
                    <input type="tel" id="senderPhone" name="senderPhone" data-key="yourPhonePlaceholder" placeholder="Your Phone Number (Optional)" class="form-input">
                    <input type="text" id="senderCompany" name="senderCompany" data-key="yourCompanyPlaceholder" placeholder="Your Company/Title (Optional)" class="form-input">
                </div>
            </div>

            <!-- Recipient details -->
            <div class="card">
                <div class="card-header">
                    <!-- Removed inline SVG here, it will be injected by script.js -->
                    <h2 data-key="recipientDetailsTitle">Recipient & Pitch Details</h2>
                </div>
                
                <div class="space-y-5">
                    <input type="text" id="recipientName" name="recipientName" data-key="recipientNamePlaceholder" placeholder="Recipient's Name" class="form-input" required>
                    <input type="text" id="companyName" name="companyName" data-key="companyNamePlaceholder" placeholder="Company Name" class="form-input" required>
                    <input type="text" id="jobTitle" name="jobTitle" data-key="jobTitlePlaceholder" placeholder="Role/Job Title" class="form-input" required>
                    
                    <select id="emailTone" name="emailTone" class="form-input" required>
                        <option value="" data-key="selectTonePlaceholder">Select a tone for your email...</option>
                        <option value="formal" data-key="toneFormal">Formal & Professional</option>
                        <option value="friendly" data-key="toneFriendly">Friendly & Approachable</option>
                        <option value="bold" data-key="toneBold">Bold & Direct</option>
                        <option value="casual" data-key="toneCasual">Casual & Conversational</option>
                        <option value="persuasive" data-key="tonePersuasive">Highly Persuasive</option>
                    </select>
                    
                    <textarea id="productService" name="productService" data-key="productServicePlaceholder" placeholder="Product/Service to Pitch" rows="3" class="form-input"></textarea>
                </div>
            </div>
        </div>

        <!-- Generate button -->
        <button id="generateBtn" class="generate-btn">
            <div class="generate-btn-shine"></div>
            <!-- This SVG is fine, as JS updates its innerHTML, not its parent's -->
            <svg id="generateBtnIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rocket"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.75-.75 1.39-1.68 1.61-2.85A10.87 10.87 0 0 0 7.5 7.5c-2.43 2.07-3.64 5.31-2.91 9z"/><path d="M14 5c0-1.5 1-2 1-2s.5-1 2-1 2 1 2 1v2l-1 1h-2L14 5Z"/><path d="M10 15V9l4-4h4l1 1v4l-4 4h-4Z"/><path d="M8 17L5 20"/><path d="M13 18l-1 1"/><path d="M16 13l1-1"/><path d="M19 10l-1-1"/></svg>
            <span id="generateBtnText" data-key="generateButton">Generate Email</span>
        </button>

        <!-- Output section -->
        <div class="output-section">
            <div class="output-header">
                <div class="flex-gap-4">
                    <!-- Removed inline SVG here, it will be injected by script.js -->
                    <h2 data-key="generatedEmailTitle">Your Generated Email</h2>
                </div>
                
                <button id="copyBtn" class="copy-btn disabled">
                    <!-- This SVG is fine, as JS updates its innerHTML, not its parent's -->
                    <svg id="copyBtnIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                    <span id="copyBtnText" data-key="copyButton">Copy to Clipboard</span>
                </button>
            </div>
            
            <div id="outputBox" class="output-content-box">
                <p class="initial-text" data-key="outputBoxInitialText">
                    Your perfectly crafted, AI-generated cold email will appear here, ready to send!
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs - IMPORTANT: Use the module versions here -->
        <!-- Firebase SDKs -->
    <script type="module">
        // Your Firebase project configuration - MUST BE THE SAME AS auth.js
        const firebaseConfig = {
            apiKey: "AIzaSyDmWNfHVuzEZariM7hPunt3zXeEXKSBlk0", // Replace with your actual API key
            authDomain: "project01-6dc41.firebaseapp.com",
            projectId: "project01-6dc41",
            storageBucket: "project01-6dc41.firebasestorage.app",
            messagingSenderId: "714586325510",
            appId: "1:714586325510:web:8d57e4654877ff298b7987",
            measurementId: "G-0BM2TWETQW"
        };

        // Import necessary Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

        // Initialize Firebase app
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app); // Get the Auth service instance

        // Listener for authentication state changes
        onAuthStateChanged(auth, (user) => {
            const LOGIN_PAGE_URL = "/complete/loginsignupsys.html"; // Adjust if your login page path changes
            const userProfileContainer = document.getElementById('userProfileContainer');
            const userNameDisplay = document.getElementById('userNameDisplay');

            if (!user) {
                // User is NOT signed in. Redirect to login page.
                console.log("User logged out or not authenticated. Redirecting to login page.");
                if (userProfileContainer) userProfileContainer.classList.add('hidden'); // Hide user info if not logged in
                // Close dropdown if user gets logged out while it's open
                const userDropdownMenu = document.getElementById('userDropdownMenu');
                if (userDropdownMenu) userDropdownMenu.classList.add('hidden'); 
                const userDropdownToggle = document.getElementById('userDropdownToggle');
                const chevronIcon = userDropdownToggle ? userDropdownToggle.querySelector('svg') : null;
                if (chevronIcon) chevronIcon.style.transform = 'rotate(0deg)';


                if (!window.location.href.includes(LOGIN_PAGE_URL)) { 
                    window.location.replace(LOGIN_PAGE_URL); 
                }
            } else {
                // User is signed in. Allow them to stay on this page and display info.
                console.log("User is signed in on main app:", user.email);
                if (userProfileContainer) userProfileContainer.classList.remove('hidden'); // Show user info
                if (userNameDisplay) {
                    // Prioritize displayName, then first part of email
                    userNameDisplay.textContent = user.displayName || user.email.split('@')[0]; 
                }
            }
        });

        // --- Logout button functionality and Dropdown toggle logic ---
        // These elements MUST be declared using 'const' or 'let' WITHIN this module scope
        // and NOT in your separate 'script.js' to avoid re-declaration errors.

        const logoutButton = document.getElementById('logoutButton'); 
        const userDropdownToggle = document.getElementById('userDropdownToggle');
        const userDropdownMenu = document.getElementById('userDropdownMenu');

        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log('User signed out successfully.');
                } catch (error) {
                    console.error('Error signing out:', error);
                    alert('Error signing out. Please try again.');
                }
            });
        }

        if (userDropdownToggle && userDropdownMenu) {
            userDropdownToggle.addEventListener('click', (event) => {
                event.stopPropagation(); 
                userDropdownMenu.classList.toggle('hidden');
                const chevronIcon = userDropdownToggle.querySelector('svg');
                if (chevronIcon) {
                    chevronIcon.style.transform = userDropdownMenu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            });

            document.addEventListener('click', (event) => {
                if (!userDropdownMenu.contains(event.target) && !userDropdownToggle.contains(event.target)) {
                    userDropdownMenu.classList.add('hidden');
                    const chevronIcon = userDropdownToggle.querySelector('svg');
                    if (chevronIcon) {
                        chevronIcon.style.transform = 'rotate(0deg)';
                    }
                }
            });
        }
    </script>
    <!-- Your main application's custom JavaScript -->
    <!-- Your main application's custom JavaScript -->
    <script src="script.js"></script>
</body>
</html>